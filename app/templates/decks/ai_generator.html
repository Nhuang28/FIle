{% extends "base.html" %}

{% block title %}AI Quiz Generator - LearnLoop{% endblock %}

{% block styles %}
<style>
    /* Custom Skeleton Pulse Animation */
    .skeleton-pulse {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% {
            background-position: 200% 0;
        }

        100% {
            background-position: -200% 0;
        }
    }

    /* Minimalist Range Slider Styles */
    input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
    }

    /* Thumb Styles */
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #ffffff;
        border: 2px solid #000000;
        cursor: pointer;
        margin-top: -8px;
    }

    input[type=range]::-moz-range-thumb {
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #ffffff;
        border: 2px solid #000000;
        cursor: pointer;
    }

    /* Track Styles */
    input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #000000;
        border-radius: 2px;
    }

    input[type=range]:focus {
        outline: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-[#E8E9E8] min-h-screen text-black font-sans">

    <!-- Centered Layout Container -->
    <div class="max-w-md mx-auto min-h-screen flex flex-col relative bg-[#E8E9E8] border-x border-black/5">

        <!-- Header -->
        <div
            class="sticky top-0 z-20 flex items-center justify-between p-4 bg-[#E8E9E8]/95 backdrop-blur-sm border-b border-black/5">
            <a href="{{ url_for('decks.view', deck_id=deck.id) }}"
                class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-black/5 transition-colors text-black">
                <span class="material-symbols-outlined">arrow_back_ios_new</span>
            </a>
            <h1 class="text-lg font-bold text-black flex-1 text-center pr-10">AI Quiz Generator</h1>
        </div>

        <!-- Main Form -->
        <form action="{{ url_for('decks.ai_generate', deck_id=deck.id) }}" method="POST" id="ai-form"
            class="flex-1 px-4 py-6 space-y-6 pb-32">

            <!-- Step 1: Source Content -->
            <div class="bg-white border border-black rounded-lg p-5 shadow-sm">
                <div class="mb-4">
                    <label class="block text-lg font-bold text-black mb-1">Step 1: Source Content</label>
                    <p class="text-sm text-gray-500">Paste your study materials, articles, or notes below.</p>
                </div>

                <div class="relative">
                    <textarea name="source_content" required
                        class="w-full min-h-[200px] bg-white border border-black rounded-md p-4 text-black placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-black resize-none text-base leading-relaxed"
                        placeholder="e.g. Photosynthesis is a process used by plants and other organisms to convert light energy into chemical energy..."></textarea>

                    <div class="flex justify-between items-center mt-2 px-1">
                        <span class="text-xs text-gray-500 font-medium">Min. 100 words recommended</span>
                        <span class="text-xs text-gray-500 font-medium" id="char-count">0 / 5000 chars</span>
                    </div>
                </div>
            </div>

            <!-- Step 2: Configuration -->
            <div class="bg-white border border-black rounded-lg p-5 shadow-sm space-y-6">
                <div class="border-b border-gray-100 pb-2">
                    <h3 class="text-lg font-bold text-black">Step 2: Configuration</h3>
                </div>

                <!-- Number of Questions Slider -->
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-black">Number of Questions</span>
                        <span class="text-xl font-bold text-black" id="num-display">5</span>
                    </div>
                    <div class="px-1">
                        <input type="range" name="num_questions" min="1" max="20" value="5" class="w-full"
                            oninput="document.getElementById('num-display').innerText = this.value">
                    </div>
                </div>

                <!-- Difficulty Level -->
                <div class="space-y-3">
                    <span class="font-bold text-black block">Difficulty Level</span>
                    <div class="grid grid-cols-3 gap-3">
                        <!-- Easy -->
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="easy" class="peer sr-only">
                            <div class="py-2.5 px-2 text-center text-sm font-medium rounded-md border border-black text-black bg-white transition-all
                                        peer-checked:bg-black peer-checked:text-white">
                                Easy
                            </div>
                        </label>
                        <!-- Medium -->
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="medium" checked class="peer sr-only">
                            <div class="py-2.5 px-2 text-center text-sm font-medium rounded-md border border-black text-black bg-white transition-all
                                        peer-checked:bg-black peer-checked:text-white">
                                Medium
                            </div>
                        </label>
                        <!-- Hard -->
                        <label class="cursor-pointer">
                            <input type="radio" name="difficulty" value="hard" class="peer sr-only">
                            <div class="py-2.5 px-2 text-center text-sm font-medium rounded-md border border-black text-black bg-white transition-all
                                        peer-checked:bg-black peer-checked:text-white">
                                Hard
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading-state" class="hidden space-y-4 transition-all duration-300">
                <div class="flex items-center justify-center gap-3 py-2">
                    <div class="w-2 h-2 bg-black rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-black rounded-full animate-bounce delay-75"></div>
                    <div class="w-2 h-2 bg-black rounded-full animate-bounce delay-150"></div>
                    <span class="text-sm font-medium text-gray-500 ml-2">Analyzing content...</span>
                </div>

                <div class="bg-white border border-dashed border-gray-300 rounded-lg p-4 space-y-3 opacity-60">
                    <div class="h-4 w-2/3 bg-gray-100 rounded skeleton-pulse"></div>
                    <div class="h-4 w-full bg-gray-100 rounded skeleton-pulse"></div>
                    <div class="h-4 w-5/6 bg-gray-100 rounded skeleton-pulse"></div>
                </div>
            </div>

        </form>

        <!-- Fixed Bottom Button -->
        <div
            class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-[#E8E9E8] via-[#E8E9E8]/90 to-transparent z-30 pointer-events-none">
            <div class="max-w-md mx-auto pointer-events-auto">
                <button type="submit" form="ai-form" onclick="validateAndSubmit()"
                    class="w-full bg-black text-white font-bold text-lg py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-gray-900 active:scale-[0.98] transition-all shadow-lg shadow-black/10">
                    <span class="material-symbols-outlined text-xl">auto_awesome</span>
                    Generate MCQs
                </button>
            </div>
        </div>

    </div>
</div>

<script>
    const textarea = document.querySelector('textarea[name="source_content"]');
    const charCountDisplay = document.getElementById('char-count');
    const loadingState = document.getElementById('loading-state');

    // Update character count
    if (textarea) {
        textarea.addEventListener('input', function () {
            const len = this.value.length;
            charCountDisplay.innerText = `${len} / 5000 chars`;
        });
    }

    function validateAndSubmit() {
        if (!textarea.value.trim()) {
            textarea.focus();
            // Optional: Shake effect or highlight error
            textarea.classList.add('ring-2', 'ring-red-500');
            setTimeout(() => textarea.classList.remove('ring-2', 'ring-red-500'), 500);
            return;
        }

        loadingState.classList.remove('hidden');

        // Scroll to loading state
        setTimeout(() => {
            loadingState.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }
</script>
{% endblock %}