{% extends "base.html" %}

{% block title %}Edit Card - LearnLoop{% endblock %}

{% block content %}
<div class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white min-h-screen">
    <!-- Desktop Centered Container -->
    <div
        class="max-w-md mx-auto min-h-screen flex flex-col shadow-2xl bg-background-light dark:bg-background-dark border-x border-slate-200 dark:border-slate-800 relative z-10">
        <!-- TopAppBar -->
        <div
            class="flex items-center bg-background-light dark:bg-background-dark p-4 pb-2 justify-between sticky top-0 z-10 border-b border-slate-200 dark:border-slate-800">
            <a href="{{ url_for('decks.view', deck_id=card.deck_id) }}"
                class="text-primary flex size-12 shrink-0 items-center justify-center cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors">
                <span class="material-symbols-outlined">arrow_back_ios_new</span>
            </a>
            <h2
                class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">
                Edit Card</h2>
        </div>

        <form action="{{ url_for('cards.edit', card_id=card.id) }}" method="POST"
            class="flex-1 overflow-y-auto pb-24 p-4 space-y-6">

            {% if card.card_type == 'mcq' %}
            <!-- MCQ Editing -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Question</label>
                    <textarea name="question" required rows="3"
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all">{{ card.mcq.question_text }}</textarea>
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Options</label>
                    {% set options = card.mcq.options %}
                    <div class="space-y-3">
                        {% for i in range(4) %}
                        <div class="flex items-center gap-2">
                            <input type="radio" name="correct_index" value="{{ i }}" {% if card.mcq.correct_index==i
                                %}checked{% endif %} class="w-5 h-5 accent-primary cursor-pointer"
                                title="Mark as correct answer">
                            <input type="text" name="option_{{ i }}" value="{{ options[i] }}" required
                                class="flex-1 p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                                placeholder="Option {{ i + 1 }}">
                        </div>
                        {% endfor %}
                    </div>
                    <p class="text-xs text-slate-500 mt-2 ml-1">Select the radio button to mark the correct answer.</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Explanation
                        (Optional)</label>
                    <textarea name="explanation" rows="3"
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="Explain why the answer is correct...">{{ card.mcq.explanation_text or '' }}</textarea>
                </div>
            </div>

            {% elif card.card_type == 'flashcard' %}
            <!-- Flashcard Editing -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Front
                        (Question)</label>
                    <textarea name="front" required rows="3"
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all">{{ card.flashcard.front_text }}</textarea>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Back (Answer)</label>
                    <textarea name="back" required rows="3"
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all">{{ card.flashcard.back_text }}</textarea>
                </div>
            </div>

            {% elif card.card_type == 'fill_gap' %}
            <!-- Fill Gap Editing -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Sentence</label>
                    <textarea name="question_text" required rows="3"
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all">{{ card.fill_gap.question_text }}</textarea>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Hidden Word
                        (Answer)</label>
                    {% set answers = card.fill_gap.answers %}
                    <input type="text" name="answer" value="{{ answers[0] }}" required
                        class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1b2127] text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:outline-none transition-all">
                </div>
            </div>
            {% endif %}

            <!-- Floating Save Button -->
            <div
                class="fixed bottom-0 left-0 right-0 z-20 w-full max-w-md mx-auto bg-white/80 dark:bg-background-dark/80 backdrop-blur-md p-4 border-t border-slate-200 dark:border-slate-800">
                <button type="submit"
                    class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 flex items-center justify-center gap-2 transition-transform active:scale-[0.98]">
                    <span class="material-symbols-outlined">save</span>
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}